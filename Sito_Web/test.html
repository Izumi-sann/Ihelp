<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Leaflet Map with Zoom-Based Pin Visibility</title>
  <!-- Include Leaflet CSS -->
  <link rel="stylesheet" href="https://unpkg.com/leaflet/dist/leaflet.css" />
  <style>
    #map {
      height: 400px;
      width: 100%;
    }
    #location {
      font-size: 18px;
    }
  </style>
</head>
<body>

  <h1>Map at a specified location : <span id="location">0, 0</span></h1>
  <div id="map"></div>

  <script src="https://unpkg.com/leaflet/dist/leaflet.js"></script>
  <script>
    // Crea la mappa centrata su una posizione iniziale (es. Berlino)
    var map = L.map('map').setView([52.5159, 13.3777], 14); // Berlino, zoom livello 14

    // Aggiungi un layer di mappa (usiamo OpenStreetMap)
    L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
      attribution: '&copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors'
    }).addTo(map);

    // Impostiamo il livello di zoom minimo per visualizzare i pin (ad esempio, zoom 12)
    var minZoomForPin = 15;
    var markers = []; // Array per tenere traccia dei marker

    // Aggiungi un evento "contextmenu" (clic destro) sulla mappa
    map.on('contextmenu', function (e) {
      // Ottieni il livello di zoom attuale
      var currentZoom = map.getZoom();

      // Verifica se il livello di zoom è abbastanza grande
      if (currentZoom >= minZoomForPin) {
        // Se il livello di zoom è sufficiente, aggiungi un marker
        var lat = e.latlng.lat;
        var lng = e.latlng.lng;

        // Aggiorna il contenuto dell'elemento <h1> con le nuove coordinate
        var locationElement = document.getElementById('location');
        locationElement.textContent = 'Map at a specified location : ' + map.getZoom();

        // Crea un nuovo marker e aggiungilo all'array
        var marker = L.marker([lat, lng]).addTo(map)
          .bindPopup('Parcheggio disabile');
          

        // Aggiungi il marker all'array markers
        markers.push(marker);
      } else {
        // Se il livello di zoom è troppo basso, mostra un avviso
        alert('Zoom in to add a pin! Please zoom to at least level ' + minZoomForPin);
      }
    });

    // Aggiungi un evento di cambiamento di zoom per nascondere o mostrare i marker
    map.on('zoomend', function () {
      var currentZoom = map.getZoom();

      // Se il livello di zoom è inferiore al minimo, nascondi i marker
      if (currentZoom < minZoomForPin) {
        markers.forEach(function(marker) {
          marker.setOpacity(0); // Nascondi il marker
        });
        document.getElementById('location').textContent = 'Zoom out to add pins.';
      } else {
        // Se il livello di zoom è sufficiente, mostra i marker
        markers.forEach(function(marker) {
          marker.setOpacity(1); // Mostra il marker
        });
        document.getElementById('location').textContent = 'Zoomed in enough. You can add pins.';
      }
    });
  </script>

</body>
</html>