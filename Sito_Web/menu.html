<!DOCTYPE html>
<html lang="en">

<!-------------------------------------------HEAD DEL SITO---------------------------------------------------->

  <head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Leaflet Map with Zoom-Based Pin Visibility</title>

  <!-----------------------------------------STILI DELLA PAGINA----------------------------------------------->

    <!--------------------LEAFLET CSS----------------------------->

      <link rel="stylesheet" href="https://unpkg.com/leaflet/dist/leaflet.css" />

    <!------------------------------------------------------------>


    <!--------------------PROVA_2 CSS----------------------------->

      <link rel="stylesheet" href="PROVA2.css" />

    <!------------------------------------------------------------>

  <!---------------------------------------------------------------------------------------------------------->

  </head>

<!----------------------------------------------FINE HEAD----------------------------------------------------->




<!--------------------------------------------BODY DEL SITO--------------------------------------------------->

<body>

  <h1>Map at a specified location : <span id="location">0, 0</span></h1>
  <div id="map"></div>

  <script src="https://unpkg.com/leaflet/dist/leaflet.js"></script>
  <script>
    // Crea la mappa centrata su una posizione iniziale (I.T.I MARCONI - Dalmine Provincia [BG] - Italy)
    var map = L.map('map').setView([45.6511, 9.594417], 16);

    // Aggiungi un layer di mappa (usiamo OpenStreetMap)
    L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
      attribution: '&copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors'
    }).addTo(map);

    // Impostiamo il livello di zoom minimo per visualizzare i pin (12)
    var minZoomForPin = 12;
    var markers = []; // Array per tenere traccia dei marker

    // Aggiungi un evento "contextmenu" (clic destro) sulla mappa
    map.on('contextmenu', function (e) {
      // Ottieni il livello di zoom attuale
      var currentZoom = map.getZoom();

      

      // Verifica se il livello di zoom è abbastanza grande
      if (currentZoom >= minZoomForPin) {
        // Se il livello di zoom è sufficiente, aggiungi un marker
        var lat = e.latlng.lat;
        var lng = e.latlng.lng;

        // Aggiorna il contenuto dell'elemento <h1> con le nuove coordinate
        var locationElement = document.getElementById('location');
        locationElement.textContent = 'Map at a specified location : ' + lat.toFixed(4) + ', ' + lng.toFixed(4) + map.getZoom();
        

/*-----------------------------------------MENU' SCELTA MARKER-----------------------------------------------*/
    
    const menu = document.createElement('div');
    menu.className = 'marker-menu';
    menu.style.display = 'none'; // Nascondi il menu di default
    document.body.appendChild(menu);

    // Funzione per posizionare il menu contestuale
    function showMenu(x, y) {
      menu.style.left = `${x}px`;
      menu.style.top = `${y}px`;
      menu.style.display = 'block';
    }

    // Funzione per nascondere il menu contestuale
    function hideMenu() {
      menu.style.display = 'none';
    }

/*-----------------------------------------------------------------------------------------------------------*/




/*--------------------------------------PULSANTI MENU' MARKER------------------------------------------------*/

  /*--------------------PULSANTE ROSSO---------------------------*/

    const redButton = document.createElement('button');
    redButton.textContent = 'Rosso';
    redButton.style.backgroundColor = 'red';
    redButton.style.color = 'white';
    menu.appendChild(redButton);
  
  /*-------------------------------------------------------------*/

  /*--------------------PULSANTE BLU-----------------------------*/

    const blueButton = document.createElement('button');
    blueButton.textContent = 'Blu';
    blueButton.style.backgroundColor = 'blue';
    blueButton.style.color = 'white';
    menu.appendChild(blueButton);

  /*-------------------------------------------------------------*/

  /*--------------------PULSANTE VERDE---------------------------*/

    const greenButton = document.createElement('button');
    greenButton.textContent = 'Verde';
    greenButton.style.backgroundColor = 'green';
    greenButton.style.color = 'white';
    menu.appendChild(greenButton);

  /*-------------------------------------------------------------*/

/*-----------------------------------------------------------------------------------------------------------*/




/*-------------------------------------------------MARKER----------------------------------------------------*/

  /*-----------------------MARKER ROSSO------------------------*/

          var redIcon = L.icon({
          iconUrl: 'https://raw.githubusercontent.com/pointhi/leaflet-color-markers/master/img/marker-icon-red.png', // Immagine del marker rosso
          shadowUrl: 'https://cdnjs.cloudflare.com/ajax/libs/leaflet/1.7.1/images/marker-shadow.png', // Ombra standard
          iconSize: [25, 41], // Dimensioni del marker
          iconAnchor: [12, 41], // Punto di ancoraggio
          popupAnchor: [1, -34], // Posizione del popup
          shadowSize: [41, 41] // Dimensioni dell'ombra
          });
  /*-----------------------------------------------------------*/


  /*-----------------------MARKER BLU--------------------------*/

          var redIcon = L.icon({
          iconUrl: 'https://raw.githubusercontent.com/pointhi/leaflet-color-markers/master/img/marker-icon-blue.png', // Immagine del marker rosso
          shadowUrl: 'https://cdnjs.cloudflare.com/ajax/libs/leaflet/1.7.1/images/marker-shadow.png', // Ombra standard
          iconSize: [25, 41], // Dimensioni del marker
          iconAnchor: [12, 41], // Punto di ancoraggio
          popupAnchor: [1, -34], // Posizione del popup
          shadowSize: [41, 41] // Dimensioni dell'ombra
          });

  /*-----------------------------------------------------------*/

  /*-----------------------MARKER VERDE------------------------*/

          var redIcon = L.icon({
          iconUrl: 'https://raw.githubusercontent.com/pointhi/leaflet-color-markers/master/img/marker-icon-green.png', // Immagine del marker rosso
          shadowUrl: 'https://cdnjs.cloudflare.com/ajax/libs/leaflet/1.7.1/images/marker-shadow.png', // Ombra standard
          iconSize: [25, 41], // Dimensioni del marker
          iconAnchor: [12, 41], // Punto di ancoraggio
          popupAnchor: [1, -34], // Posizione del popup
          shadowSize: [41, 41] // Dimensioni dell'ombra
          });

  /*-----------------------------------------------------------*/

/*-----------------------------------------------------------------------------------------------------------*/

























/*---------------------------------------------CREAZIONE MARKER----------------------------------------------*/
        
        var marker = L.marker([lat, lng], { icon: redIcon }).addTo(map)
        .bindPopup('Parcheggio disabile');
          

        // Aggiungi il marker all'array markers
        markers.push(marker);
      } else {
        // Se il livello di zoom è troppo basso, mostra un avviso
        alert('Zoom in to add a pin! Please zoom to at least level ' + minZoomForPin);
      }
    });

/*-----------------------------------------------------------------------------------------------------------*/




/*-----------------------------------------COMPORTAMENTO MARKER----------------------------------------------*/

  /*--------------------ZOOM MAPPA-----------------------------*/

    map.on('zoomend', function () {
      var currentZoom = map.getZoom();

  /*-----------------------------------------------------------*/


  /*--------------------MARKER OFF-----------------------------*/

      if (currentZoom < minZoomForPin) {
        markers.forEach(function(marker) {
          marker.setOpacity(0); // Nascondi il marker
        });
        document.getElementById('location').textContent = 'Zoom out to add pins.';
      } 
      
  /*-----------------------------------------------------------*/

  /*--------------------MARKER ON------------------------------*/

      else {
        // Se il livello di zoom è sufficiente, mostra i marker
        markers.forEach(function(marker) {
          marker.setOpacity(1); // Mostra il marker
        });
        document.getElementById('location').textContent = 'Zoomed in enough. You can add pins.';
      }
    });

  /*-----------------------------------------------------------*/

/*-----------------------------------------------------------------------------------------------------------*/


  </script>

</body>

<!----------------------------------------------FINE BODY----------------------------------------------------->

</html>